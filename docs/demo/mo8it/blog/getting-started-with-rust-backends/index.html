<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Getting started with Rust backends</title>

        <meta name="description"
              content="A tutorial for getting started with web backends in Rust with the Axum framework">

        <link rel="icon"
              type="image/x-icon"
              href="https://salif.github.io/zola-themes-collection/demo/mo8it/images/logo.svg?v=1734990758">

        <link href="https://salif.github.io/zola-themes-collection/demo/mo8it/main.css?v=1734990758"
              rel="stylesheet">

        <link rel="alternate"
              type="application/atom+xml"
              title="Blog | mo8it.com"
              href="https://salif.github.io/zola-themes-collection/demo/mo8it/atom.xml">

        <meta property="og:title" content="Getting started with Rust backends">
        <meta property="og:description" content="A tutorial for getting started with web backends in Rust with the Axum framework">
        <meta property="og:image"
              content="https://salif.github.io/zola-themes-collection/demo/mo8it/images/logo.svg?v=1734990758">
        <meta property="og:url" content="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/">
    </head>

    <body class="flex flex-col p-3 mx-auto min-h-screen text-lg text-gray-100 break-words bg-gray-900 lg:px-5 2xl:container">
        <header class="flex gap-x-6 items-center py-2 px-2.5 mb-1 bg-gray-800 rounded-full">
            <a class="transition duration-500 hover:scale-110"
               href="https://salif.github.io/zola-themes-collection/demo/mo8it"
               aria-hidden="true">
                <img class="m-0 w-12 h-12 rounded-full"
                     src="https://salif.github.io/zola-themes-collection/demo/mo8it/images/logo.svg"
                     alt="">
            </a>

            <nav class="flex gap-x-5 items-center font-bold">
                
                    <a class="p-1 no-underline" href="/">Home</a>
                
                    <a class="p-1 no-underline" href="/blog">Blog</a>
                
                    <a class="p-1 no-underline" href="/tags">Tags</a>
                
            </nav>
        </header>

        <main class="leading-relaxed">
            
    <article>
        <div class="mb-3">
            <h1>Getting started with Rust backends</h1>

            
    <div class="mt-2 mb-4 text-sm leading-normal text-gray-300">
        <time datetime="2023-04-01">2023-04-01</time><time datetime="2024-01-21">, updated: 2024-01-21</time><p class="my-0">
            Tags:
            <a href="https://salif.github.io/zola-themes-collection/demo/mo8it/tags/rust">#rust</a><span class="pr-1.5">,</span><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/tags/axum">#axum</a><span class="pr-1.5">,</span><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/tags/web">#web</a></p>

        <p class="my-0">Reading time: ~7min</p>

        <hr class="my-2.5">
    </div>

        </div>

        <p>How hard can it be to write a web backend in Rust?
We will try to answer this question through an example.</p>
<span id="continue-reading"></span>
<p>The example will be a simple HTML contact form with the following elements:</p>
<ul>
<li>Name field</li>
<li>Email field</li>
<li>Message field</li>
<li>Submit button</li>
<li>Error message</li>
</ul>
<p>The web server will serve this form and handle its submission.
In case the form submission was not valid, the form is returned back without losing the user's input.
Otherwise, the user receives a confirmation that the contact form was submitted successfully.</p>

    <p class="p-1 my-4 text-base rounded sm:hidden bg-yellow-200/20">Landscape mode recommended on mobile devices</p>

    
        <div class="px-4 pt-3 pb-0.5 mt-3 mb-1 bg-gray-800 rounded">
            <p class="text-2xl font-bold">Contents</p>

            <nav>
                <ul class="ml-0 list-none">
                    
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#dependencies">Dependencies</a>
                                    <ul class="my-0 ml-5 list-none">
                                        
                                            
                                                <li><a class="text-base" href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#imports">Imports</a></li>
                                            
                                        
                                    </ul>
                                </li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#server">Server</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#form-template">Form template</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#rendering-templates">Rendering templates</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#index-handler">Index handler</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#success-template">Success template</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#form-deserialization">Form deserialization</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#test">Test</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#error-message">Error message</a></li>
                        
                    
                        
                            <li><a href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/getting-started-with-rust-backends/#conclusion">Conclusion</a>
                                    <ul class="my-0 ml-5 list-none">
                                        
                                            
                                        
                                            
                                        
                                    </ul>
                                </li>
                        
                    
                </ul>
            </nav>
        </div>
    

<h4 id="disclaimer"><a class="text-white no-underline transition-none hover:underline"
   href="#disclaimer">Disclaimer</a></h4>
<p>If you are a beginner, you can take this post as a demonstration of what you can achieve with a basic Rust backend, but don't get distracted by details üòµ‚Äçüí´</p>
<p>This is not an HTML/CSS tutorial.
The HTML pages will be ugly, but <em>functional</em>.
You can add design details later üé®
Personally, I would recommend <a href="https://tailwindcss.com">Tailwind CSS</a>.</p>
<h2 id="dependencies"><a class="text-white no-underline transition-none hover:underline"
   href="#dependencies">Dependencies</a></h2>
<p>The example uses the following crates:</p>
<ul>
<li><a href="https://docs.rs/axum/0.7.4/axum">axum</a>: Web framework</li>
<li><a href="https://docs.rs/askama/0.12.1/askama">askama</a>: Templating engine with compile time template validation</li>
<li><a href="https://docs.rs/tokio/1.35.1/tokio">tokio</a>: Asynchronous runtime</li>
<li><a href="https://docs.rs/serde/1.0.195/serde">serde</a>: (De)Serialization</li>
</ul>
<p>To follow the example, create a new Rust project with <code>cargo new</code> and add the following dependencies to <code>Cargo.toml</code>:</p>
<pre data-lang="toml" style="background-color:#212733;color:#ccc9c2;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#73d0ff;">dependencies</span><span>]
</span><span style="color:#73d0ff;">askama </span><span>= </span><span style="color:#bae67e;">&quot;0.12.1&quot;
</span><span style="color:#73d0ff;">axum </span><span>= </span><span style="color:#bae67e;">&quot;0.7.4&quot;
</span><span style="color:#73d0ff;">serde </span><span>= { </span><span style="color:#73d0ff;">version </span><span>= </span><span style="color:#bae67e;">&quot;1.0.195&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#73d0ff;">features </span><span>= [</span><span style="color:#bae67e;">&quot;derive&quot;</span><span>] }
</span><span style="color:#73d0ff;">tokio </span><span>= { </span><span style="color:#73d0ff;">version </span><span>= </span><span style="color:#bae67e;">&quot;1.35.1&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#73d0ff;">features </span><span>= [</span><span style="color:#bae67e;">&quot;macros&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#bae67e;">&quot;rt-multi-thread&quot;</span><span>] }
</span></code></pre>
<h3 id="imports"><a class="text-white no-underline transition-none hover:underline"
   href="#imports">Imports</a></h3>
<p>All imports used in the example are gathered below to keep later code snippets slim:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ffa759;">use </span><span>askama</span><span style="color:#f29e74;">::</span><span>Template</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ffa759;">use </span><span>axum</span><span style="color:#f29e74;">::</span><span>{
</span><span>    extract</span><span style="color:#f29e74;">::</span><span>Form</span><span style="color:#ccc9c2cc;">,
</span><span>    http</span><span style="color:#f29e74;">::</span><span>StatusCode</span><span style="color:#ccc9c2cc;">,
</span><span>    response</span><span style="color:#f29e74;">::</span><span>{Html</span><span style="color:#ccc9c2cc;">,</span><span> IntoResponse</span><span style="color:#ccc9c2cc;">,</span><span> Response}</span><span style="color:#ccc9c2cc;">,
</span><span>    routing</span><span style="color:#f29e74;">::</span><span>{get</span><span style="color:#ccc9c2cc;">,</span><span> post</span><span style="color:#ccc9c2cc;">,</span><span> Router}</span><span style="color:#ccc9c2cc;">,
</span><span>}</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ffa759;">use </span><span>serde</span><span style="color:#f29e74;">::</span><span>Deserialize</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ffa759;">use </span><span>std</span><span style="color:#f29e74;">::</span><span>io</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ffa759;">use </span><span>tokio</span><span style="color:#f29e74;">::</span><span>net</span><span style="color:#f29e74;">::</span><span>TcpListener</span><span style="color:#ccc9c2cc;">;
</span></code></pre>
<h2 id="server"><a class="text-white no-underline transition-none hover:underline"
   href="#server">Server</a></h2>
<p>Let's finally start building the server!</p>
<p>In the following snippet, we build a test router that returns "Hello world!".
Then we build the server to serve the router on <code>localhost</code> which is equivalent to IPv4 address <code>127.0.0.1</code>.</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ccc9c2cc;">#</span><span>[</span><span style="color:#ffd580;">tokio</span><span>::</span><span style="color:#ffd580;">main</span><span>]
</span><span>async </span><span style="color:#ffa759;">fn </span><span style="color:#ffd580;">main</span><span>() </span><span style="color:#ccc9c2cc;">-&gt; </span><span>io</span><span style="color:#f29e74;">::</span><span style="font-style:italic;color:#5ccfe6;">Result</span><span>&lt;()&gt; {
</span><span>    </span><span style="color:#ffa759;">let</span><span> router </span><span style="color:#f29e74;">= </span><span>Router</span><span style="color:#f29e74;">::</span><span>new()
</span><span>        </span><span style="color:#f29e74;">.</span><span style="color:#f28779;">route</span><span>(</span><span style="color:#bae67e;">&quot;/&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#f28779;">get</span><span>(</span><span style="color:#bae67e;">&quot;Hello world!&quot;</span><span>))</span><span style="color:#ccc9c2cc;">;
</span><span>
</span><span>    </span><span style="color:#ffa759;">let</span><span> listener </span><span style="color:#f29e74;">= </span><span>TcpListener</span><span style="color:#f29e74;">::</span><span>bind(</span><span style="color:#bae67e;">&quot;127.0.0.1:8080&quot;</span><span>)</span><span style="color:#f29e74;">.</span><span>await</span><span style="color:#f29e74;">?</span><span style="color:#ccc9c2cc;">;
</span><span>    </span><span style="color:#f28779;">println!</span><span>(</span><span style="color:#bae67e;">&quot;Listening on http://</span><span style="color:#ffcc66;">{}</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span> listener</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">local_addr</span><span>()</span><span style="color:#f29e74;">?</span><span>)</span><span style="color:#ccc9c2cc;">;
</span><span>
</span><span>    axum</span><span style="color:#f29e74;">::</span><span>serve(listener</span><span style="color:#ccc9c2cc;">,</span><span> router)</span><span style="color:#f29e74;">.</span><span>await
</span><span>}
</span></code></pre>
<p>Run the program and visit <code>http://127.0.0.1:8080</code> in your browser to see the "Hello world!" message.</p>
<p>Congratulations, you did just build your first Rust web server üéâ</p>
<div class="rounded-xl bg-sky-400/20">
    <div class="px-2 pt-2 pb-1 my-3 text-white">
        <p class="font-bold">Note</p>
        <p>You need to use the socket address <code>0.0.0.0</code> (with some port) when you want to host the server in a container for example.</p>

    </div>
</div>
<h2 id="form-template"><a class="text-white no-underline transition-none hover:underline"
   href="#form-template">Form template</a></h2>
<p>Now, we want to create the form template to serve it instead of "Hello world!".</p>
<p>First, create the directory <code>templates</code> where all templates will be placed (default directory for <code>askama</code>).</p>
<p>Write the following form template in the file <code>templates/form.html</code>:</p>
<pre data-lang="html" style="background-color:#212733;color:#ccc9c2;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#5ccfe690;">&lt;!</span><span style="color:#ffa759;">DOCTYPE </span><span style="color:#ffcc66;">html</span><span style="color:#5ccfe690;">&gt;
</span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">html </span><span style="color:#ffd580;">lang</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;en&quot;</span><span style="color:#5ccfe690;">&gt;
</span><span>    </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">body</span><span style="color:#5ccfe690;">&gt;
</span><span>        </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">form </span><span style="color:#ffd580;">action</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;/submit&quot; </span><span style="color:#ffd580;">method</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;post&quot;</span><span style="color:#5ccfe690;">&gt;
</span><span>            </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">label </span><span style="color:#ffd580;">for</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;name&quot;</span><span style="color:#5ccfe690;">&gt;</span><span>Name</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">label</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">input </span><span style="color:#ffd580;">type</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;text&quot; </span><span style="color:#ffd580;">name</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;name&quot; </span><span style="color:#ffd580;">id</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;name&quot; </span><span style="color:#ffd580;">value</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;{{ name }}&quot; </span><span style="color:#ffd580;">required</span><span style="color:#5ccfe690;">&gt;
</span><span>            </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>
</span><span>            </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">label </span><span style="color:#ffd580;">for</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;email&quot;</span><span style="color:#5ccfe690;">&gt;</span><span>Email</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">label</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">input </span><span style="color:#ffd580;">type</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;email&quot; </span><span style="color:#ffd580;">name</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;email&quot; </span><span style="color:#ffd580;">id</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;email&quot; </span><span style="color:#ffd580;">value</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;{{ email }}&quot; </span><span style="color:#ffd580;">required</span><span style="color:#5ccfe690;">&gt;
</span><span>            </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>
</span><span>            </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>                    </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">label </span><span style="color:#ffd580;">for</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;message&quot;</span><span style="color:#5ccfe690;">&gt;</span><span>Message</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">label</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>                </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">textarea </span><span style="color:#ffd580;">name</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;message&quot; </span><span style="color:#ffd580;">id</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;message&quot; </span><span style="color:#ffd580;">required</span><span style="color:#5ccfe690;">&gt;</span><span>{{ message }}</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">textarea</span><span style="color:#5ccfe690;">&gt;
</span><span>            </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">div</span><span style="color:#5ccfe690;">&gt;
</span><span>
</span><span>            </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">button </span><span style="color:#ffd580;">type</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;submit&quot;</span><span style="color:#5ccfe690;">&gt;</span><span>Submit</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">button</span><span style="color:#5ccfe690;">&gt;
</span><span>        </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">form</span><span style="color:#5ccfe690;">&gt;
</span><span>    </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">body</span><span style="color:#5ccfe690;">&gt;
</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">html</span><span style="color:#5ccfe690;">&gt;
</span></code></pre>
<p>This template produces a form like the one below:</p>
<div style="margin-top: 2rem; margin-bottom: 2rem;">
    <div style="margin-bottom: 0.4rem;">
        <label for="name">Name</label>
        <input type="text" id="name" value="Ferris" required>
    </div>
    <div style="margin-bottom: 0.4rem;">
        <label for="email">Email</label>
        <input type="email" id="email" value="ferris@rust-lang.org" required>
    </div>
    <div style="margin-bottom: 0.4rem;">
        <div>
            <label for="message">Message</label>
        </div>
        <textarea id="message" required>Are we web yet?</textarea>
    </div>
    <button style="padding: 0.2rem; border-width: 1px;">Submit</button>
</div>
<p>Did you notice the three variables inside <code>{{ }}</code>?
These placeholders will be replaced by the values provided to the template.</p>
<p>Now, we define a struct representing the template in our Rust code.
It has the fields that we use as placeholders in our template:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ccc9c2cc;">#</span><span>[</span><span style="color:#ffd580;">derive</span><span>(Template</span><span style="color:#ccc9c2cc;">,</span><span> Default)]
</span><span style="color:#ccc9c2cc;">#</span><span>[</span><span style="color:#ffd580;">template</span><span>(path </span><span style="color:#f29e74;">= </span><span style="color:#bae67e;">&quot;form.html&quot;</span><span>)]
</span><span style="color:#ffa759;">struct </span><span style="color:#73d0ff;">FormTemplate</span><span>&lt;</span><span style="color:#ffa759;">&#39;a</span><span>&gt; {
</span><span>    name</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span style="color:#ffa759;">&#39;a str</span><span>,
</span><span>    email</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span style="color:#ffa759;">&#39;a str</span><span>,
</span><span>    message</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span style="color:#ffa759;">&#39;a str</span><span>,
</span><span>}
</span></code></pre>
<p><code>path</code> points to the template's path inside of the <code>templates</code> directory.</p>
<p>Note that we derive the trait <code>Default</code> to be able to create the template with empty strings as the default.</p>
<h2 id="rendering-templates"><a class="text-white no-underline transition-none hover:underline"
   href="#rendering-templates">Rendering templates</a></h2>
<p>To serve the template, it has to be rendered and returned as a response by a handler.</p>
<p>Because rendering a template and returning it as a response is common in a backend,
we want to write a function that does that for us:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ffa759;">fn </span><span style="color:#ffd580;">render_template</span><span>(</span><span style="color:#ffcc66;">template</span><span style="color:#ccc9c2cc;">:</span><span> impl Template) </span><span style="color:#ccc9c2cc;">-&gt;</span><span> Response {
</span><span>    </span><span style="color:#ffa759;">match</span><span> template</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">render</span><span>() {
</span><span>        </span><span style="font-style:italic;color:#5ccfe6;">Ok</span><span>(rendered) </span><span style="color:#f29e74;">=&gt;</span><span> Html(rendered)</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">into_response</span><span>()</span><span style="color:#ccc9c2cc;">,
</span><span>        </span><span style="font-style:italic;color:#5ccfe6;">Err</span><span>(e) </span><span style="color:#f29e74;">=&gt; </span><span>{
</span><span>            </span><span style="color:#f28779;">eprintln!</span><span>(</span><span style="color:#bae67e;">&quot;Failed to render a template: </span><span style="color:#ffcc66;">{e:?}</span><span style="color:#bae67e;">&quot;</span><span>)</span><span style="color:#ccc9c2cc;">;
</span><span>
</span><span>            StatusCode</span><span style="color:#f29e74;">::</span><span style="color:#ffcc66;">INTERNAL_SERVER_ERROR</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">into_response</span><span>()
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>In case the template could not be rendered, the status code 500 is returned as a representation of an internal server error.</p>
<p>Now, we can use this function to render our form template.</p>
<h2 id="index-handler"><a class="text-white no-underline transition-none hover:underline"
   href="#index-handler">Index handler</a></h2>
<p>The handler responsible of rendering our form template is very simple:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span>async </span><span style="color:#ffa759;">fn </span><span style="color:#ffd580;">index</span><span>() </span><span style="color:#ccc9c2cc;">-&gt;</span><span> Response {
</span><span>    </span><span style="color:#ffa759;">let</span><span> template </span><span style="color:#f29e74;">= </span><span>FormTemplate</span><span style="color:#f29e74;">::</span><span>default()</span><span style="color:#ccc9c2cc;">;
</span><span>    </span><span style="color:#f28779;">render_template</span><span>(template)
</span><span>}
</span></code></pre>
<p>First, we initialize the templates with default values since the default of <code>String</code> is an empty string.
Then, we return the response of our template rendering function.</p>
<p>Now, we have to let this handler handle <code>GET</code> requests to our index path.
This is done by replacing the "Hello World!" string in the <code>main</code> function with our handler function <code>index</code>:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ffa759;">let</span><span> router </span><span style="color:#f29e74;">= </span><span>Router</span><span style="color:#f29e74;">::</span><span>new()
</span><span>    </span><span style="color:#f29e74;">.</span><span style="color:#f28779;">route</span><span>(</span><span style="color:#bae67e;">&quot;/&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#f28779;">get</span><span>(index))</span><span style="color:#ccc9c2cc;">;
</span></code></pre>
<p>Now, run the program and visit <code>127.0.0.1:8080</code> in your browser to see the form üéâ</p>
<p>You can fill it, but submitting will not work because we are not handling form submissions yet.</p>
<h2 id="success-template"><a class="text-white no-underline transition-none hover:underline"
   href="#success-template">Success template</a></h2>
<p>Let's prepare for handling a form submission!</p>
<p>After a successful form submission, we want to give the user some feedback.
Therefore, we create the template <code>templates/success.html</code>:</p>
<pre data-lang="html" style="background-color:#212733;color:#ccc9c2;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#5ccfe690;">&lt;!</span><span style="color:#ffa759;">DOCTYPE </span><span style="color:#ffcc66;">html</span><span style="color:#5ccfe690;">&gt;
</span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">html </span><span style="color:#ffd580;">lang</span><span style="color:#ccc9c2cc;">=</span><span style="color:#bae67e;">&quot;en&quot;</span><span style="color:#5ccfe690;">&gt;
</span><span>    </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">body</span><span style="color:#5ccfe690;">&gt;
</span><span>        </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">p</span><span style="color:#5ccfe690;">&gt;</span><span>Thank you for contacting us, {{ name }}. We will reach out to you as soon as possible.</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">p</span><span style="color:#5ccfe690;">&gt;
</span><span>    </span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">body</span><span style="color:#5ccfe690;">&gt;
</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">html</span><span style="color:#5ccfe690;">&gt;
</span></code></pre>
<p>The template takes the name of the user as a template variable.
This has to be reflected in the struct of this template:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ccc9c2cc;">#</span><span>[</span><span style="color:#ffd580;">derive</span><span>(Template)]
</span><span style="color:#ccc9c2cc;">#</span><span>[</span><span style="color:#ffd580;">template</span><span>(path </span><span style="color:#f29e74;">= </span><span style="color:#bae67e;">&quot;success.html&quot;</span><span>)]
</span><span style="color:#ffa759;">struct </span><span style="color:#73d0ff;">SuccessTemplate</span><span>&lt;</span><span style="color:#ffa759;">&#39;a</span><span>&gt; {
</span><span>    name</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span style="color:#ffa759;">&#39;a str</span><span>,
</span><span>}
</span></code></pre>
<div class="rounded-xl bg-sky-400/20">
    <div class="px-2 pt-2 pb-1 my-3 text-white">
        <p class="font-bold">Note</p>
        <p>In a real project, you should use a <a href="https://djc.github.io/askama/template_syntax.html#child-template">base template</a> to prevent duplication!</p>

    </div>
</div>
<h2 id="form-deserialization"><a class="text-white no-underline transition-none hover:underline"
   href="#form-deserialization">Form deserialization</a></h2>
<p>Before returning the success template, we have to receive the form.
To do so, we write a deserialization struct for our form with the expected input fields:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ccc9c2cc;">#</span><span>[</span><span style="color:#ffd580;">derive</span><span>(Deserialize)]
</span><span style="color:#ffa759;">struct </span><span style="color:#73d0ff;">FormFields </span><span>{
</span><span>    name</span><span style="color:#ccc9c2cc;">:</span><span> String,
</span><span>    email</span><span style="color:#ccc9c2cc;">:</span><span> String,
</span><span>    message</span><span style="color:#ccc9c2cc;">:</span><span> String,
</span><span>}
</span></code></pre>
<p>The deserialization struct can now be used with Axum's <code>Form</code> <a href="https://docs.rs/axum/0.7.4/axum/extract">extractor</a> that tries to deserialize a request form into this struct.
This extractor will be the only argument of our form submission handler:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span>async </span><span style="color:#ffa759;">fn </span><span style="color:#ffd580;">submit</span><span>(</span><span style="color:#ffcc66;">fields</span><span style="color:#ccc9c2cc;">: </span><span>Form&lt;FormFields&gt;) </span><span style="color:#ccc9c2cc;">-&gt;</span><span> Response {
</span><span>    </span><span style="color:#ffa759;">if</span><span> fields</span><span style="color:#f29e74;">.</span><span>name</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">len</span><span>() </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">2 </span><span style="color:#f29e74;">||</span><span> fields</span><span style="color:#f29e74;">.</span><span>email</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">len</span><span>() </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">3 </span><span style="color:#f29e74;">|| !</span><span>fields</span><span style="color:#f29e74;">.</span><span>email</span><span style="color:#f29e74;">.</span><span style="color:#f28779;">contains</span><span>(</span><span style="color:#bae67e;">&#39;@&#39;</span><span>) {
</span><span>        </span><span style="color:#ffa759;">let</span><span> template </span><span style="color:#f29e74;">=</span><span> FormTemplate {
</span><span>            name</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>name</span><span style="color:#ccc9c2cc;">,
</span><span>            email</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>email</span><span style="color:#ccc9c2cc;">,
</span><span>            message</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>message</span><span style="color:#ccc9c2cc;">,
</span><span>        }</span><span style="color:#ccc9c2cc;">;
</span><span>        </span><span style="color:#ffa759;">return </span><span style="color:#f28779;">render_template</span><span>(template)</span><span style="color:#ccc9c2cc;">;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#f28779;">println!</span><span>(
</span><span>        </span><span style="color:#bae67e;">&quot;Submission:</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Name: </span><span style="color:#ffcc66;">{}</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Email: </span><span style="color:#ffcc66;">{}</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Message: </span><span style="color:#ffcc66;">{}</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,
</span><span>        </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>name</span><span style="color:#ccc9c2cc;">, </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>email</span><span style="color:#ccc9c2cc;">, </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>message
</span><span>    )</span><span style="color:#ccc9c2cc;">;
</span><span>
</span><span>    </span><span style="color:#ffa759;">let</span><span> template </span><span style="color:#f29e74;">=</span><span> SuccessTemplate { name</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span>fields</span><span style="color:#f29e74;">.</span><span>name }</span><span style="color:#ccc9c2cc;">;
</span><span>    </span><span style="color:#f28779;">render_template</span><span>(template)
</span><span>}
</span></code></pre>
<p>First, we do some server side form validation.
<strong>This is not a good email validation!</strong>
It is just a placeholder for demonstration.</p>
<p>If the submitted form is not valid, we return the form template back, but this time with the fields from the form so that the user doesn't lose his form input.</p>
<p>If the form is valid, we print the submitted fields to stdout just as a placeholder for some proper handling of a successful contact.</p>
<p>Now, let's make this handler handle <code>POST</code> requests to the <code>/submit</code> path (the path that <code>action</code> in our form template points to):</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ffa759;">let</span><span> router </span><span style="color:#f29e74;">= </span><span>Router</span><span style="color:#f29e74;">::</span><span>new()
</span><span>    </span><span style="color:#f29e74;">.</span><span style="color:#f28779;">route</span><span>(</span><span style="color:#bae67e;">&quot;/&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#f28779;">get</span><span>(index))
</span><span>    </span><span style="color:#f29e74;">.</span><span style="color:#f28779;">route</span><span>(</span><span style="color:#bae67e;">&quot;/submit&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#f28779;">post</span><span>(submit))</span><span style="color:#ccc9c2cc;">;
</span></code></pre>
<h2 id="test"><a class="text-white no-underline transition-none hover:underline"
   href="#test">Test</a></h2>
<p>Now that we implemented our two important handlers, let's test our backend.</p>
<p>Run the program and visit <code>http://127.0.0.1:8080</code> in your browser to see the form.</p>
<p>Fill the form and submit it to see the success feedback üéâ</p>
<p>Take a look at your terminal, the submission is printed there!</p>
<p>Now, go back and fill the form again, but this time with only one character in the name field. This will trigger the server side validation and return the form back.
Although no form input is lost, the user doesn't know what he did wrong üòï</p>
<p>We need to show some error message after an invalid form.</p>
<h2 id="error-message"><a class="text-white no-underline transition-none hover:underline"
   href="#error-message">Error message</a></h2>
<p>Let's add an error message to the form template:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ffa759;">struct </span><span style="color:#73d0ff;">FormTemplate</span><span>&lt;</span><span style="color:#ffa759;">&#39;a</span><span>&gt; {
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// ‚Ä¶
</span><span>    error_message</span><span style="color:#ccc9c2cc;">: </span><span style="color:#f29e74;">&amp;</span><span style="color:#ffa759;">&#39;a str</span><span>,
</span><span>}
</span></code></pre>
<p>Now, the Rust compiler will tell you that you have to do a modification in the <code>submit</code> handler:</p>
<pre data-lang="rust" style="background-color:#212733;color:#ccc9c2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ffa759;">let</span><span> template </span><span style="color:#f29e74;">=</span><span> FormTemplate {
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// ‚Ä¶
</span><span>    error_message</span><span style="color:#ccc9c2cc;">: </span><span style="color:#bae67e;">&quot;Invalid input!&quot;</span><span style="color:#ccc9c2cc;">,
</span><span>}</span><span style="color:#ccc9c2cc;">;
</span></code></pre>
<p>The Rust compiler will also warn you that the field <code>error_message</code> is not used!
This is right because we didn't use it in our template file <code>templates/form.html</code> yet.
Add the following just before the submit button:</p>
<pre data-lang="html" style="background-color:#212733;color:#ccc9c2;" class="language-html "><code class="language-html" data-lang="html"><span>{% if !error_message.is_empty() %}
</span><span>    </span><span style="color:#5ccfe690;">&lt;</span><span style="color:#73d0ff;">p</span><span style="color:#5ccfe690;">&gt;</span><span>{{ error_message }}</span><span style="color:#5ccfe690;">&lt;/</span><span style="color:#73d0ff;">p</span><span style="color:#5ccfe690;">&gt;
</span><span>{% endif %}
</span></code></pre>
<p>Now, run the program and test again with only one character in the name field to see the error message üéâ</p>
<h2 id="conclusion"><a class="text-white no-underline transition-none hover:underline"
   href="#conclusion">Conclusion</a></h2>
<p>We can't deny that Rust has a steep learning curve.
In this blog post, we skipped many of the used key concepts in Rust like lifetimes and traits.
But after you go through the first chapters in <a href="https://doc.rust-lang.org/stable/book">the Rust book</a>, you will be able to start working on your own web backend in Rust.
In fact, such a contact form was my second Rust project!</p>
<p>Rust will even make your life easier.
The compiler shifts many bugs from runtime to compile time, <code>serde</code> (de)serializes for you, <code>askama</code> makes sure your templates are valid at compile time etc.
In Rust, you have an army of tools that give you the feeling that "if it compiles, it works".</p>
<p>On top of that, you get all the benefits of Rust regarding performance, low resource usage etc.</p>
<p>I hope that this post was an icebreaker for you.
What are you waiting for?
Let's make the web rusty! üòÉ</p>
<hr />
<h4 id="full-code"><a class="text-white no-underline transition-none hover:underline"
   href="#full-code">Full code</a></h4>
<p>The full code used in this post can be found <a href="https://codeberg.org/mo8it/blog_demos/src/branch/main/getting-started-with-rust-backends">here</a>.</p>
<h4 id="credits"><a class="text-white no-underline transition-none hover:underline"
   href="#credits">Credits</a></h4>
<p>The blog post is inspired by the following <a href="https://spacedimp.com/blog/using-rust-axum-postgresql-and-tokio-to-build-a-blog">blog post on spacedimp.com</a> about building a blog in Rust.
I recommend reading it after this post üòÉ</p>

    </article>

    
        <nav class="flex flex-col gap-y-3 mt-8">
            
    
    <a class="py-1.5 px-3 my-2 no-underline bg-gray-800 rounded-xl transition duration-500 hover:scale-[1.02]"
       href="https://salif.github.io/zola-themes-collection/demo/mo8it/blog/containerized-postgresql-with-rootless-podman/">Next post: Containerized PostgreSQL with rootless Podman<hr class="mt-1 mb-3 rounded-none border-gray-600"><span class="text-white">How to run rootless Podman containers with PostgreSQL as a central example</span></a>


            
        </nav>
    

    <section class="mt-8 text-base text-center">
        <p>
            You can suggest improvements on the <a href="https://codeberg.org/mo8it/website/src/branch/main/content/blog">website's repository</a>
        </p>
        <p>
            Content license: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>
        </p>
    </section>

        </main>

        <footer class="pt-2 pb-3 mt-auto">
            <img class="m-0 mx-auto w-20 h-20"
                 src="https://salif.github.io/zola-themes-collection/demo/mo8it/images/happy_ferris.svg"
                 alt="">

            <nav class="flex flex-col gap-y-3 justify-around py-3 text-center bg-gray-800 rounded sm:flex-row sm:rounded-full">
                
                    <a class="text-sm no-underline" href="/contact">Contact</a>
                
                    <a class="text-sm no-underline" href="https://codeberg.org/mo8it/website">Source Code</a>
                
                    <a class="text-sm no-underline" href="/legal-notice">Legal Notice</a>
                
                    <a class="text-sm no-underline" href="/privacy-policy">Privacy Policy</a>
                
            </nav>
        </footer>

        
            <script type="module" src="https://oxitraffic.mo8it.com/count.js"></script>
        
    </body>
</html>
