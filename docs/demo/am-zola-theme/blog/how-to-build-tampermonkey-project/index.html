<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMZola Theme Demo</title>
    <link rel="stylesheet" href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/style.css">
    <style>
        :root {
            --theme-color: #ff2d55;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/js/background.js"></script>
    <script src="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/js/theme-toggle.js"></script>
</head>
<body>
    <div id="bg-canvas-container" 
         data-colors='["#5dc1dd","#e9b32b","#e32c84","#2196f3"]'
         style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; overflow: hidden;">
    </div>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="card menu-card">
                <div class="menu-section">
                    <div class="search-bar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <span>搜索</span>
                    </div>
                    
                    <nav class="main-nav">
                        <ul>
                            <li>
                                <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/" class="">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                    首页
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <div class="menu-section">
                    <h3 class="section-title">分类</h3>
                    <nav class="sub-nav">
                        <ul>
                            <li>
                                <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/blog/" class="active">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                                    博客
                                </a>
                            </li>
                            <li>
                                <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/music/" class="">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                                    音乐
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="menu-section">
                    <h3 class="section-title">Library</h3>
                    <nav class="sub-nav">
                        <ul>
                            <li>
                                <a href="https:&#x2F;&#x2F;salif.github.io&#x2F;zola-themes-collection&#x2F;demo&#x2F;am-zola-theme&#x2F;/tags">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                                    标签
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                    最近
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                
                <div class="sidebar-footer">
                    <button id="theme-toggle" class="theme-toggle-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <span class="theme-text" 
                              data-dark="深色模式"
                              data-light="浅色模式">深色模式</span>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            
<article class="post">
    <header class="post-header card">
        
        
        <div class="header-content">
            <h1 class="post-title">使用 Vite + TypeScript 搭建油猴项目</h1>
            <div class="post-meta">
                
                <span class="author">Gemini</span>
                
                <time datetime="2025-11-28">2025 年 11 月 28 日
</time>
                
                <span class="tags">
                    
                    <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/tags/tampermonkey/">#tampermonkey</a>
                    
                    <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/tags/typescript/">#typescript</a>
                    
                    <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/tags/vite/">#vite</a>
                    
                    <a href="https://salif.github.io/zola-themes-collection/demo/am-zola-theme/tags/web/">#web</a>
                    
                </span>
                
            </div>
        </div>
    </header>

    <div class="post-content card">
        <h1 id="shi-yong-vite-typescript-da-jian-you-hou-xiang-mu">使用 Vite + TypeScript 搭建油猴项目</h1>
<p>这里是一个从零开始的完整步骤：</p>
<h2 id="1-zhun-bei-huan-jing">1. 准备环境</h2>
<p>确保你已经安装了 <a href="https://nodejs.org/">Node.js</a> (它会自带 npm)。</p>
<h2 id="2-chu-shi-hua-vite-xiang-mu">2. 初始化 Vite 项目</h2>
<p>我们将使用 Vite 的 <code>vanilla-ts</code> (原生 TS) 模板来创建一个新项目。</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 你可以使用 npm, pnpm 或 yarn
</span><span style="color:#bf616a;">npm</span><span> create vite@latest my-tampermonkey-script -- --template vanilla-ts
</span></code></pre>
<p>进入项目目录：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd</span><span> my-tampermonkey-script
</span></code></pre>
<h2 id="3-an-zhuang-yi-lai">3. 安装依赖</h2>
<p>你需要安装两个关键的开发依赖：</p>
<ol>
<li><strong><code>vite-plugin-monkey</code></strong>: 核心插件，它会处理元数据注入、打包和热更新。</li>
<li><strong><code>@types/tampermonkey</code></strong>: Tampermonkey 的 TypeScript 类型定义，让你在编码时可以获得 <code>GM_...</code> 函数的智能提示。</li>
</ol>
<!-- end list -->
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">npm</span><span> install vite-plugin-monkey @types/tampermonkey</span><span style="color:#bf616a;"> --save-dev
</span></code></pre>
<h2 id="4-pei-zhi-vite-vite-config-ts">4. 配置 Vite (vite.config.ts)</h2>
<p>这是最关键的一步。打开项目根目录下的 <code>vite.config.ts</code> 文件，修改为以下内容：</p>
<pre data-lang="typescript" style="background-color:#2b303b;color:#c0c5ce;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#65737e;">// vite.config.ts
</span><span style="color:#b48ead;">import </span><span>{ </span><span style="color:#bf616a;">defineConfig </span><span>} </span><span style="color:#b48ead;">from </span><span>&quot;</span><span style="color:#a3be8c;">vite</span><span>&quot;;
</span><span style="color:#b48ead;">import </span><span style="color:#bf616a;">monkey</span><span>, { </span><span style="color:#bf616a;">cdn </span><span>} </span><span style="color:#b48ead;">from </span><span>&quot;</span><span style="color:#a3be8c;">vite-plugin-monkey</span><span>&quot;;
</span><span>
</span><span style="color:#65737e;">// https://vitejs.dev/config/
</span><span style="color:#b48ead;">export default </span><span style="color:#8fa1b3;">defineConfig</span><span>({
</span><span>  plugins: [
</span><span>    </span><span style="color:#8fa1b3;">monkey</span><span>({
</span><span>      </span><span style="color:#65737e;">// 插件入口文件
</span><span>      entry: &quot;</span><span style="color:#a3be8c;">src/main.ts</span><span>&quot;,
</span><span>
</span><span>      </span><span style="color:#65737e;">// 用户脚本的元数据
</span><span>      userscript: {
</span><span>        </span><span style="color:#65737e;">// 脚本名称
</span><span>        name: &quot;</span><span style="color:#a3be8c;">我的第一个TS油猴脚本</span><span>&quot;,
</span><span>        </span><span style="color:#65737e;">// 命名空间
</span><span>        namespace: &quot;</span><span style="color:#a3be8c;">http://tampermonkey.net/</span><span>&quot;,
</span><span>        </span><span style="color:#65737e;">// 版本
</span><span>        version: &quot;</span><span style="color:#a3be8c;">0.1.0</span><span>&quot;,
</span><span>        </span><span style="color:#65737e;">// 描述
</span><span>        description: &quot;</span><span style="color:#a3be8c;">使用 Vite + TS 编写的油猴脚本</span><span>&quot;,
</span><span>        </span><span style="color:#65737e;">// 作者
</span><span>        author: &quot;</span><span style="color:#a3be8c;">你</span><span>&quot;,
</span><span>        </span><span style="color:#65737e;">// 匹配的域名
</span><span>        match: [&quot;</span><span style="color:#a3be8c;">*://*.google.com/*</span><span>&quot;],
</span><span>        </span><span style="color:#65737e;">// 脚本需要的权限
</span><span>        </span><span style="color:#65737e;">// @grant 指令
</span><span>        grant: [&quot;</span><span style="color:#a3be8c;">GM_addStyle</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">GM_getValue</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">GM_setValue</span><span>&quot;],
</span><span>      },
</span><span>
</span><span>      </span><span style="color:#65737e;">// 配置构建
</span><span>      build: {
</span><span>        </span><span style="color:#65737e;">// （可选）将外部库（如 Vue, React）通过 CDN 引入，
</span><span>        </span><span style="color:#65737e;">// 而不是打包到脚本中
</span><span>        externalGlobals: {
</span><span>          </span><span style="color:#65737e;">// vue: cdn.jsdelivr(&#39;Vue&#39;, &#39;dist/vue.global.prod.js&#39;),
</span><span>        },
</span><span>      },
</span><span>    }),
</span><span>  ],
</span><span>});
</span></code></pre>
<blockquote>
<p><strong>重要提示</strong>：</p>
<ul>
<li><code>userscript</code> 对象中的字段会<strong>自动生成</strong>为 Tampermonkey 需要的 <code>// ==UserScript==</code> 头部。</li>
<li>你需要在这里（<code>userscript.match</code>）指定脚本在哪个网站上运行。</li>
<li>如果你用到了 <code>GM_</code> 开头的函数，<strong>必须</strong>在 <code>userscript.grant</code> 数组中声明它们。</li>
</ul>
</blockquote>
<h2 id="5-pei-zhi-typescript-tsconfig-json">5. 配置 TypeScript (tsconfig.json)</h2>
<p>为了让 TS 认识 Tampermonkey 的 API (如 <code>GM_addStyle</code>)，你需要将类型定义添加到 <code>tsconfig.json</code> 中。</p>
<p>打开 <code>tsconfig.json</code>，找到 <code>compilerOptions.types</code> 数组，在里面加入 <code>@types/tampermonkey</code>：</p>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span>  &quot;</span><span style="color:#a3be8c;">compilerOptions</span><span>&quot;: {
</span><span>    </span><span style="color:#65737e;">// ... 其他选项 ...
</span><span>
</span><span>    &quot;</span><span style="color:#a3be8c;">types</span><span>&quot;: [&quot;</span><span style="color:#a3be8c;">vite/client</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">@types/tampermonkey</span><span>&quot;] </span><span style="color:#65737e;">// &lt;-- 添加在这里
</span><span>
</span><span>    </span><span style="color:#65737e;">// ... 其他选项 ...
</span><span>  }
</span><span>}
</span></code></pre>
<h2 id="6-bian-xie-ni-de-jiao-ben-src-main-ts">6. 编写你的脚本 (src/main.ts)</h2>
<p>现在可以清空 <code>src/main.ts</code> 里的默认内容，开始编写你的油猴脚本了。</p>
<pre data-lang="typescript" style="background-color:#2b303b;color:#c0c5ce;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#65737e;">// src/main.ts
</span><span>
</span><span style="color:#65737e;">// 这是一个 TypeScript 模块，我们可以在这里使用 import
</span><span style="color:#b48ead;">import </span><span>{ </span><span style="color:#bf616a;">log </span><span>} </span><span style="color:#b48ead;">from </span><span>&quot;</span><span style="color:#a3be8c;">./utils</span><span>&quot;; </span><span style="color:#65737e;">// 假设你有一个 utils.ts 文件
</span><span>
</span><span style="color:#65737e;">// ==UserScript==
</span><span style="color:#65737e;">// 注意：你不需要在这里写元数据块！
</span><span style="color:#65737e;">// vite-plugin-monkey 会自动从 vite.config.ts 生成它。
</span><span style="color:#65737e;">// ==/UserScript==
</span><span>
</span><span>(</span><span style="color:#b48ead;">function </span><span>() {
</span><span>  &quot;</span><span style="color:#a3be8c;">use strict</span><span>&quot;;
</span><span>
</span><span>  </span><span style="color:#ebcb8b;">console</span><span>.</span><span style="color:#96b5b4;">log</span><span>(&quot;</span><span style="color:#a3be8c;">你好，Tampermonkey + TypeScript!</span><span>&quot;);
</span><span>
</span><span>  </span><span style="color:#65737e;">// 使用你在 config.grant 中声明的 API
</span><span>  </span><span style="color:#65737e;">// 你会发现 GM_addStyle 现在有代码提示了
</span><span>  </span><span style="color:#8fa1b3;">GM_addStyle</span><span>(`
</span><span style="color:#a3be8c;">    body {
</span><span style="color:#a3be8c;">      background-color: #f0f0f0;
</span><span style="color:#a3be8c;">    }
</span><span style="color:#a3be8c;">  </span><span>`);
</span><span>
</span><span>  </span><span style="color:#65737e;">// 使用导入的模块
</span><span>  </span><span style="color:#8fa1b3;">log</span><span>(&quot;</span><span style="color:#a3be8c;">脚本已加载</span><span>&quot;);
</span><span>
</span><span>  </span><span style="color:#65737e;">// 演示 GM_getValue 和 GM_setValue
</span><span>  </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">runCount </span><span>= </span><span style="color:#8fa1b3;">GM_getValue</span><span>(&quot;</span><span style="color:#a3be8c;">runCount</span><span>&quot;, </span><span style="color:#d08770;">0</span><span>);
</span><span>  </span><span style="color:#ebcb8b;">console</span><span>.</span><span style="color:#96b5b4;">log</span><span>(`</span><span style="color:#a3be8c;">这个脚本已经运行了 ${</span><span style="color:#bf616a;">runCount</span><span style="color:#a3be8c;">} 次</span><span>`);
</span><span>  </span><span style="color:#8fa1b3;">GM_setValue</span><span>(&quot;</span><span style="color:#a3be8c;">runCount</span><span>&quot;, </span><span style="color:#bf616a;">runCount </span><span>+ </span><span style="color:#d08770;">1</span><span>);
</span><span>})();
</span></code></pre>
<h2 id="7-kai-fa-yu-re-geng-xin-zui-shuang-de-yi-bu">7. 开发与热更新 (最爽的一步)</h2>
<ol>
<li>
<p><strong>启动开发服务器</strong>：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">npm</span><span> run dev
</span></code></pre>
</li>
<li>
<p><strong>安装脚本</strong>：
Vite 会在终端显示一个本地服务器地址，类似 <code>http://localhost:5173/</code>。</p>
<p><code>vite-plugin-monkey</code> 会生成一个 "开发模式" 的脚本。你只需要访问这个地址，然后加上你的脚本文件名（通常是 <code>[项目名].user.js</code>）。</p>
<p>在终端的输出中找到类似下面这行：
<code>&gt; Local: http://localhost:5173/my-tampermonkey-script.user.js</code></p>
<p><strong>复制这个 URL</strong>，在浏览器中打开它。Tampermonkey 会弹出来，提示你安装这个脚本。<strong>请点击安装</strong>。</p>
</li>
<li>
<p><strong>体验热更新</strong>：</p>
<ul>
<li>你刚才安装的 "开发脚本" 实际上是一个“加载器”，它会自动从你的本地 <code>localhost:5173</code> 服务器拉取最新的代码。</li>
<li>现在，去你设置的 <code>match</code> 网站 (例如 <code>google.com</code>)。</li>
<li>尝试修改你的 <code>src/main.ts</code> 文件 (比如改一下 <code>console.log</code> 的内容或 CSS 样式) 并<strong>保存</strong>。</li>
<li><strong>你不需要重新安装脚本</strong>，只需要刷新 <code>google.com</code> 页面，就能立刻看到最新的修改！</li>
</ul>
</li>
</ol>
<h2 id="8-gou-jian-sheng-chan-huan-jing-jiao-ben">8. 构建生产环境脚本</h2>
<p>当你完成了开发，准备把脚本分享给别人时，运行：</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">npm</span><span> run build
</span></code></pre>
<p>Vite 会在 <code>dist</code> 文件夹中生成一个最终的 <code>.user.js</code> 文件 (例如 <code>dist/my-tampermonkey-script.user.js</code>)。这个文件已经打包了你所有的 TS 代码、注入了元数据，并且已经编译和压缩为纯 JS。</p>
<p>你只需要把这个 <code>dist</code> 目录下的 <code>.user.js</code> 文件拖到浏览器，或分享给他人，就可以永久安装了。</p>

    </div>
</article>

        </main>
    </div>
</body>
</html>
